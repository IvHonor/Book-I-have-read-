<!DOCTYPE html>
<html lang="en">
<%- include("partials/header") %>
<body>
  <h1>DANIAL RAHMANI</h1>

  <h2>My Wishlist</h2>
  <p>
    This is a list of books I plan to read in the future. I’ll keep adding new titles as I discover them.
  </p>

  <div class="auth-links">
    <a href="/" class="btn btn-secondary">📖 Books Read</a>

    <% if (!session.authenticated) { %>
      <a href="/login?redirect=/wishlist" class="btn btn-login">🔐 Login</a>
    <% } else { %>
      <form action="/logout" method="POST" style="display:inline;">
        <input type="hidden" name="redirect" value="<%= request.originalUrl %>">
        <button type="submit" class="btn btn-logout">🚪 Logout</button>
      </form>
    <% } %>
  </div>

  <% if (session.authenticated) { %>
    <div class="add-button">
      <a href="/wishlist/add">➕ Add to Wishlist</a>
    </div>
  <% } %>

  <hr>

  <% if (wishlist.length === 0) { %>
    <p style="margin-top: 30px; font-style: italic; color: #777;">
      Your wishlist is empty.
    </p>
  <% } else { %>
    <% wishlist.forEach(book => { %>
      <div class="book-entry <%= book.marked_read ? 'read' : '' %>">
        <% if (book.cover_url) { %>
          <div class="cover-wrapper">
            <img src="<%= book.cover_url %>" alt="Cover of <%= book.title %>" class="cover-image <%= book.marked_read ? 'read' : '' %>">
            <% if (book.marked_read) { %>
              <div class="read-badge">✅ Read</div>
            <% } %>
          </div>
        <% } %>

        <div class="book-content">
          <h3 class="book-title">
            <%= book.title %><% if (book.author) { %> - by <%= book.author %><% } %>
          </h3>

          <p class="book-meta">
            📅 Added: <%= new Date(book.date_added).toLocaleDateString() %>
          </p>

          <% if (session.authenticated) { %>
            <div class="book-actions">
              <!-- Delete button -->
              <form action="/wishlist/delete" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this book from your wishlist?');">
                <input type="hidden" name="id" value="<%= book.id %>">
                <button type="submit" class="btn btn-delete">❌ Delete</button>
              </form>

              <!-- Mark or unmark -->
              <form action="/wishlist/toggle-read" method="POST" style="display:inline;">
                <input type="hidden" name="id" value="<%= book.id %>">
                <button type="submit" class="btn btn-secondary">
                  <%= book.marked_read ? '↩️ Unmark' : '✅ Mark as Read' %>
                </button>
              </form>
            </div>
          <% } %>
        </div>
      </div>
      <hr>
    <% }) %>
  <% } %>
</body>
</html>
